# ============================================================================
# Basic Settings
# ============================================================================

# Set prefix key (uncomment if you want to change from default Ctrl-b)
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# General settings
set -g base-index 1                    # start indexing windows at 1
set -g pane-base-index 1               # start indexing panes at 1
set -g detach-on-destroy off           # don't exit from tmux when closing a session
set -g escape-time 0                   # zero-out escape time delay
set -g history-limit 1000000           # increase history size
set -g renumber-windows on             # renumber all windows when any window is closed
set -g set-clipboard on                # use system clipboard
set -g status-position top             # status bar at top
set -g mouse on                        # enable mouse support
setw -g mode-keys vi                   # use vi keys in copy mode
setw -g automatic-rename on            # automatically rename windows

# ============================================================================
# Terminal & Display Settings
# ============================================================================

set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'
set-environment -g COLORTERM "truecolor"

# Display settings
set -g display-time 4000               # status messages display time
set -g display-panes-time 4000         # pane numbers display time
set -g display-panes-active-colour colour33    # blue
set -g display-panes-colour colour166           # orange

# ============================================================================
# Key Bindings
# ============================================================================

# Window management
bind r command-prompt "rename-window %%"
bind R source-file ~/.config/tmux/.tmux.conf \; display-message "Config reloaded!"
bind c new-window -c "#{pane_current_path}"

# Pane splitting (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"  # keep your original
bind b split-window -v -c "#{pane_current_path}"  # keep your original

# Pane navigation (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Copy mode improvements
bind Enter copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# Session management
bind S command-prompt -p "New session name:" "new-session -s '%1'"
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# Quick pane layouts
bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

# ============================================================================
# Plugin Configuration
# ============================================================================

# Plugin list
set -g @plugin "tmux-plugins/tpm"
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "tmux-plugins/tmux-yank"
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @plugin "catppuccin/tmux#v2.1.3"

# Plugin settings
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'iterm'

# FZF URL settings
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit "2000"

# ============================================================================
# Theme Configuration (Catppuccin)
# ============================================================================

set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "basic"
set -g @catppuccin_status_background "none"
set -g @catppuccin_pane_status_enabled "off"
set -g @catppuccin_pane_border_status "off"

# Status bar configuration
set -g status-left-length 100
set -g status-right-length 100
set -g status-left ""
set -g status-right ""

# Custom status separator
set -g @custom_status_separator "#[fg=#{@thm_overlay_2},bg=default,none]"

# Status left modules
set -ga status-left "#[fg=#{@thm_green}]#{?client_prefix,#[fg=#{@thm_red}]#[reverse]#[bold],} 󰕮 #S #[none]"
set -ga status-left "#{E:#{@custom_status_separator}}"

# Status right modules
set -ga status-right "#{?window_zoomed_flag,#[fg=#{@thm_yellow}] 󰁌 zoom ,}"
set -ga status-right "#{?pane_marked,#[fg=#{@thm_yellow}] 󰈻 marked ,}"
set -ga status-right "#{?#{||:#{window_zoomed_flag},#{pane_marked}},#{E:#{@custom_status_separator}},}"
set -ga status-right "#[fg=#{@thm_lavender}] 󰃭 %d-%m-%Y 󰅐 %H:%M "

# ============================================================================
# Performance & Behavior
# ============================================================================

# Reduce repeat time for repeatable commands
set -g repeat-time 600

# Increase scrollback buffer
set -g history-limit 50000

# Address vim mode switching delay
set -s escape-time 0

# Refresh status more often
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# ============================================================================
# Initialize Plugins
# ============================================================================

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.tmux/plugins/tpm/tpm"